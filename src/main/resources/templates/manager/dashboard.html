<!DOCTYPE html>
<html th:replace="~{layouts/manager-layout :: layout(~{::#content}, ~{::#page-scripts}, 'Dashboard', null, null)}"
    xmlns:th="http://www.thymeleaf.org">

    <div id="content">
        <!-- Dashboard Overview Cards -->
        <div class="row mb-4">
            <!-- Total Services -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="avatar avatar-lg bg-primary-transparent">
                                <i class="ri-flask-line fs-20"></i>
                            </div>
                            <div class="ms-3">
                                <p class="mb-1 text-muted fs-12">Total Services</p>
                                <h5 class="mb-0 fw-semibold" th:text="${dashboardStats.totalServices ?: 0}">0</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Orders -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="avatar avatar-lg bg-success-transparent">
                                <i class="ri-calendar-check-line fs-20"></i>
                            </div>
                            <div class="ms-3">
                                <p class="mb-1 text-muted fs-12">Active Orders</p>
                                <h5 class="mb-0 fw-semibold" th:text="${dashboardStats.activeOrders ?: 0}">0</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pending Results -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="avatar avatar-lg bg-warning-transparent">
                                <i class="ri-file-search-line fs-20"></i>
                            </div>
                            <div class="ms-3">
                                <p class="mb-1 text-muted fs-12">Pending Results</p>
                                <h5 class="mb-0 fw-semibold" th:text="${dashboardStats.pendingResults ?: 0}">0</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Total Customers -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="avatar avatar-lg bg-info-transparent">
                                <i class="ri-user-3-line fs-20"></i>
                            </div>
                            <div class="ms-3">
                                <p class="mb-1 text-muted fs-12">Total Customers</p>
                                <h5 class="mb-0 fw-semibold" th:text="${dashboardStats.totalCustomers ?: 0}">0</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Orders Management Table -->
        <div class="row">
            <div class="col-12">
                <div class="card custom-card">
                    <div class="card-header">
                        <div class="card-title">Recent Orders</div>
                        <div class="ms-auto">
                            <a th:href="@{/manager/order-management}" class="btn btn-sm btn-outline-primary me-2">
                                <i class="ri-eye-line me-1"></i> View All Orders
                            </a>
                            <a th:href="@{/manager/services}" class="btn btn-sm btn-primary">
                                <i class="ri-add-line me-1"></i> Manage Services
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table text-nowrap table-bordered">
                                <thead>
                                    <tr>
                                        <th scope="col">Order ID</th>
                                        <th scope="col">Customer</th>
                                        <th scope="col">Service</th>
                                        <th scope="col">Status</th>
                                        <th scope="col">Created Date</th>
                                        <th scope="col">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:if="${recentOrders == null or #lists.isEmpty(recentOrders)}">
                                        <td colspan="6" class="text-center text-muted">No recent orders found</td>
                                    </tr>
                                    <tr th:each="order : ${recentOrders}" th:if="${recentOrders != null}">
                                        <td>
                                            <span class="fw-semibold text-primary"
                                                th:text="'#' + ${order.id}">N/A</span>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <span class="avatar avatar-xs me-2 avatar-rounded bg-light">
                                                    <i class="ri-user-line"></i>
                                                </span>
                                                <span th:text="${order.customerName ?: 'N/A'}">Customer Name</span>
                                            </div>
                                        </td>
                                        <td th:text="${order.serviceName ?: 'N/A'}">Service Name</td>
                                        <td>
                                            <span th:class="'badge ' + ${order.orderStatus.name() == 'COMPLETED' ? 'bg-success-transparent' :
                                                                      (order.orderStatus.name() == 'IN_PROGRESS' ? 'bg-primary-transparent' :
                                                                      (order.orderStatus.name() == 'PENDING' ? 'bg-warning-transparent' :
                                                                      (order.orderStatus.name() == 'CANCELLED' ? 'bg-danger-transparent' :
                                                                      'bg-secondary-transparent')))}"
                                                th:text="${order.orderStatus.name().replace('_', ' ')}">Status</span>
                                        </td>
                                        <td th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy')}">Date</td>
                                        <td>
                                            <div class="hstack gap-2 flex-wrap">
                                                <a th:href="@{/manager/order-management(id=${order.id})}"
                                                    class="text-info fs-14 lh-1" data-bs-toggle="tooltip"
                                                    title="View Details">
                                                    <i class="ri-eye-line"></i>
                                                </a>
                                                <a href="javascript:void(0);" class="text-primary fs-14 lh-1"
                                                    data-bs-toggle="tooltip" title="Edit">
                                                    <i class="ri-edit-line"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-3 d-flex justify-content-end"
                            th:if="${recentOrders != null and not #lists.isEmpty(recentOrders)}">
                            <a th:href="@{/manager/order-management}" class="btn btn-sm btn-outline-primary">
                                View All Orders <i class="ri-arrow-right-line ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity and Quick Actions -->
        <div class="row">
            <!-- Recent Activity -->
            <div class="col-xl-6 col-lg-12">
                <div class="card custom-card">
                    <div class="card-header">
                        <div class="card-title">Recent Activity</div>
                        <div class="ms-auto">
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="refreshActivity()">
                                <i class="ri-refresh-line"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled mb-0 activity-timeline">
                            <li th:if="${recentActivities == null or #lists.isEmpty(recentActivities)}"
                                class="text-center text-muted py-3">
                                No recent activities found
                            </li>
                            <li th:each="activity : ${recentActivities}" th:if="${recentActivities != null}"
                                class="activity-item">
                                <div th:class="'activity-icon ' + ${activity.type == 'ORDER' ? 'bg-primary' :
                                                                   (activity.type == 'CUSTOMER' ? 'bg-success' :
                                                                   (activity.type == 'PAYMENT' ? 'bg-info' :
                                                                   (activity.type == 'RESULT' ? 'bg-warning' :
                                                                   'bg-secondary')))}">
                                    <i th:class="${activity.type == 'ORDER' ? 'ri-file-text-line' :
                                                  (activity.type == 'CUSTOMER' ? 'ri-user-add-line' :
                                                  (activity.type == 'PAYMENT' ? 'ri-money-dollar-circle-line' :
                                                  (activity.type == 'RESULT' ? 'ri-file-search-line' :
                                                  'ri-notification-line')))}"></i>
                                </div>
                                <div class="ms-3">
                                    <h6 class="mb-1 fw-semibold" th:text="${activity.title}">Activity Title</h6>
                                    <p class="mb-0 text-muted fs-12" th:text="${activity.description}">Activity
                                        Description</p>
                                    <span class="text-muted fs-11" th:text="${activity.timeAgo}">Time ago</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Quick Actions & Stats -->
            <div class="col-xl-6 col-lg-12">
                <div class="card custom-card">
                    <div class="card-header">
                        <div class="card-title">Quick Actions</div>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-6">
                                <a th:href="@{/manager/services}" class="btn btn-outline-primary w-100">
                                    <i class="ri-flask-line me-2"></i>
                                    <div>
                                        <div class="fw-semibold">Services</div>
                                        <small>Manage DNA Services</small>
                                    </div>
                                </a>
                            </div>
                            <div class="col-6">
                                <a th:href="@{/manager/order-management}" class="btn btn-outline-success w-100">
                                    <i class="ri-file-list-3-line me-2"></i>
                                    <div>
                                        <div class="fw-semibold">Orders</div>
                                        <small>View All Orders</small>
                                    </div>
                                </a>
                            </div>
                            <div class="col-6">
                                <a th:href="@{/manager/reports}" class="btn btn-outline-warning w-100">
                                    <i class="ri-bar-chart-line me-2"></i>
                                    <div>
                                        <div class="fw-semibold">Reports</div>
                                        <small>Analytics & Reports</small>
                                    </div>
                                </a>
                            </div>
                        </div>

                        <!-- Monthly Stats Chart Placeholder -->
                        <div class="mt-4">
                            <h6 class="fw-semibold mb-3">Monthly Performance</h6>
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="p-2 bg-primary-transparent rounded">
                                        <div class="fw-semibold text-primary" th:text="${monthlyStats.newOrders ?: 0}">0
                                        </div>
                                        <small class="text-muted">New Orders</small>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="p-2 bg-success-transparent rounded">
                                        <div class="fw-semibold text-success"
                                            th:text="${monthlyStats.completedOrders ?: 0}">0</div>
                                        <small class="text-muted">Completed</small>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="p-2 bg-info-transparent rounded">
                                        <div class="fw-semibold text-info" th:text="'$' + ${monthlyStats.revenue ?: 0}">
                                            $0</div>
                                        <small class="text-muted">Revenue</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="page-scripts">
        <script th:inline="javascript">
            document.addEventListener('DOMContentLoaded', function () {
                // Initialize tooltips
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });

                console.log('Manager dashboard loaded successfully');
            });

            function refreshActivity() {
                // Refresh activity feed
                location.reload();
            }

            // Auto-refresh dashboard data every 5 minutes
            setInterval(function () {
                // You can implement AJAX refresh here instead of full page reload
                console.log('Auto-refreshing dashboard data...');
            }, 300000);

            function showAlert(type, message) {
                const alertContainer = document.querySelector('.container-fluid') || document.querySelector('#main-content');
                const existingAlert = alertContainer.querySelector('.alert');

                if (existingAlert) {
                    existingAlert.remove();
                }

                const alert = document.createElement('div');
                alert.className = `alert alert-${type} alert-dismissible fade show`;
                alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
                alertContainer.insertBefore(alert, alertContainer.firstChild);

                // Auto-dismiss after 5 seconds
                setTimeout(() => {
                    if (alert && alert.parentNode) {
                        alert.remove();
                    }
                }, 5000);
            }
        </script>

        <script type="text/html" th:replace="~{fragments/common/scripts :: scripts}"></script>
    </div>
    <!-- Dashboard Scripts -->



</html>
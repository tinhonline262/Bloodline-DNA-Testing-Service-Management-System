<!-- staff/list-test-results.html -->
<div th:fragment="content">
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1 class="header-title">Test Results Management</h1>
            <div class="controls">
                <form th:action="@{/staff/search-test-results}" method="get" class="search-form">
                    <input type="text" name="query" placeholder="Search by test result ID..." required />
                    <button type="submit" class="btn-primary">Search</button>
                    <a th:href="@{/staff/list-test-results}" class="btn-secondary">Reset</a>
                </form>

                <form th:action="@{/staff/filter-test-results}" method="get" class="filter-form">
                    <label for="status">Filter by Status:</label>
                    <select name="status" id="status" required>
                        <option th:each="resultsStatus : ${T(com.dna_testing_system.dev.enums.ResultStatus).values()}"
                                th:value="${resultsStatus}"
                                th:text="${resultsStatus}"
                                th:selected="${resultsStatus == resultsStatus}">
                        </option>
                    </select>
                    <button type="submit" class="btn-primary">Filter</button>
                </form>
            </div>
        </div>

        <!-- Table Section -->
        <div class="table-container">
            <div class="table-header">
                <h2>Test Results List</h2>
            </div>

            <table>
                <thead>
                <tr>
                    <th>Test ID</th>
                    <th>Test Date</th>
                    <th>Result Summary</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="result : ${testResults}">
                    <td><strong th:text="${result.testResultId}"></strong></td>
                    <td>
                        <div style="font-size: 13px;" th:text="${#temporals.format(result.testDate, 'dd/MM/yyyy')}"></div>
                        <div style="font-size: 12px; color: #64748b;" th:text="${#temporals.format(result.testDate, 'HH:mm')}"></div>
                    </td>
                    <td>
                        <div class="result-summary" th:text="${result.resultSummary}" th:title="${result.resultSummary}"></div>
                    </td>
                    <td>
                        <span class="status-badge"
                              th:class="${'status-badge ' + (result.resultStatus == 'COMPLETED' ? 'status-completed' :
                                        result.resultStatus == 'PROCESSING' ? 'status-processing' :
                                        result.resultStatus == 'FAILED' ? 'status-failed' : 'status-pending')}"
                              th:text="${result.resultStatus}"></span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a th:if="${result.rawTestId != null}"
                               th:href="@{/staff/details-test-result(testResultId=${result.testResultId})}"
                               class="action-link">Details</a>
                            <span th:if="${result.rawTestId == null}" class="disabled-link">Details</span>

                            <a th:if="${result.rawTestId != null}"
                               th:href="@{/staff/update-test-result(testResultId=${result.testResultId})}"
                               class="action-link update">Update Result</a>
                            <span th:if="${result.rawTestId == null}" class="disabled-link">Update Result</span>

                            <a th:if="${result.rawTestId != null}"
                               th:href="@{/staff/update-raw-data(testResultId=${result.testResultId})}"
                               class="action-link raw">Update Raw</a>
                            <span th:if="${result.rawTestId == null}" class="disabled-link">Update Raw</span>

                            <a th:if="${result.rawTestId == null}"
                               th:href="@{/staff/create-raw-data(testResultsId=${result.testResultId})}"
                               class="action-link create">Create Raw Data</a>
                            <span th:if="${result.rawTestId != null}" class="disabled-link">Create Raw Data</span>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

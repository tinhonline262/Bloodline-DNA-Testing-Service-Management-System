<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en"
    th:fragment="layout(content, scripts, pageTitle, breadcrumbs, actionButtons)" dir="ltr" data-nav-layout="vertical"
    data-theme-mode="light" data-header-styles="light" data-menu-styles="light  " loader="disable"
    data-vertical-style="overlay" class="mdl-js" data-toggled="icon-overlay-close">

<head th:replace="~{fragments/common/meta :: common-meta}"></head>
<style>
    /* Enhanced Responsive Styles for Admin Layout */
    @media (max-width: 991.98px) {

        /* Sidebar improvements */
        .app-sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 999;
        }

        .app-sidebar.active {
            transform: translateX(0);
        }

        .main-content {
            margin-left: 0 !important;
            transition: margin-left 0.3s ease;
        }

        /* Header improvements for mobile */
        .main-header-container {
            padding: 0.5rem 1rem;
        }

        .header-element .sidemenu-toggle {
            display: block !important;
        }
    }

    @media (max-width: 768px) {

        /* Further mobile optimizations */
        .page-header-breadcrumb {
            flex-direction: column;
            align-items: flex-start !important;
        }

        .page-header-breadcrumb .d-flex {
            margin-top: 1rem;
            width: 100%;
            justify-content: flex-start;
        }

        /* Table improvements */
        .table-responsive {
            border: none;
            margin-bottom: 0;
        }

        .table th,
        .table td {
            padding: 0.5rem 0.25rem;
            font-size: 0.875rem;
        }

        /* Card improvements */
        .card-body {
            padding: 1rem;
        }

        .row.mb-4 .col-xl-3 {
            margin-bottom: 1rem;
        }
    }

    /* Sidebar overlay for mobile */
    .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 998;
        display: none;
    }
</style>

<body class="app sidebar-mini ltr">

    <!-- Main Wrapper -->
    <div class="page">
        <!-- Header -->
        <div th:replace="~{fragments/admin/header :: header}"></div>
        <!-- End Header -->

        <!-- Sidebar -->
        <div th:replace="~{fragments/admin/sidebar :: sidebar}"></div>
        <!-- End Sidebar -->

        <!-- Main Content -->
        <div class="main-content app-content">
            <div class="container-fluid">
                <!-- Page Header -->
                <div class="d-md-flex d-block align-items-center justify-content-between my-4 page-header-breadcrumb">
                    <div class="my-auto">
                        <h5 class="page-title fs-21 mb-1" th:text="${pageTitle} ?: 'Admin Dashboard'">Admin Dashboard
                        </h5>
                        <nav th:if="${breadcrumbs}">
                            <ol class="breadcrumb mb-0">
                                <li class="breadcrumb-item"><a th:href="@{/admin/dashboard}">Dashboard</a></li>
                                <th:block th:each="crumb, iterStat : ${breadcrumbs}">
                                    <li th:if="${!iterStat.last}" class="breadcrumb-item">
                                        <a th:href="${crumb.url}" th:text="${crumb.label}">Item</a>
                                    </li>
                                    <li th:if="${iterStat.last}" class="breadcrumb-item active"
                                        th:text="${crumb.label}">Current Page
                                    </li>
                                </th:block>
                            </ol>
                        </nav>
                    </div>

                    <div th:if="${actionButtons}" class="d-flex my-xl-auto right-content align-items-center">
                        <th:block th:replace="${actionButtons}"></th:block>
                    </div>
                </div>
                <!-- End Page Header -->

                <!-- Main Content -->
                <div th:replace="${content}"></div>
                <!-- End Main Content -->
            </div>
        </div>
        <!-- End Main Content -->

        <!-- Footer -->
        <div th:replace="~{fragments/admin/footer :: footer}"></div>
        <!-- End Footer -->
    </div>
    <!-- End Main Wrapper -->

    <!-- Back-to-top -->
    <a href="#top" id="back-to-top"><i class="ri-arrow-up-line"></i></a>

    <th:block th:replace="${scripts} ?: _"></th:block>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            // Xử lý sự kiện click cho các mục menu
            const menuItems = document.querySelectorAll('.side-menu__item');

            menuItems.forEach(function (item) {
                item.addEventListener('click', function (e) {
                    // Loại bỏ lớp active khỏi tất cả các slide
                    document.querySelectorAll('.slide').forEach(function (slide) {
                        slide.classList.remove('active');
                    });

                    // Loại bỏ lớp active khỏi tất cả các side-menu__item
                    document.querySelectorAll('.side-menu__item').forEach(function (menuItem) {
                        menuItem.classList.remove('active');
                    });

                    // Thêm lớp active vào slide chứa mục được nhấp
                    const parentSlide = this.closest('.slide');
                    if (parentSlide) {
                        parentSlide.classList.add('active');
                    }

                    // Thêm lớp active vào side-menu__item được nhấp
                    this.classList.add('active');

                    // Lưu trạng thái active vào localStorage để duy trì qua các lần tải trang
                    localStorage.setItem('activeMenuItem', this.getAttribute('href'));
                });
            });

            // Kiểm tra và đặt lại mục menu hoạt động khi tải trang
            const activeMenuItem = localStorage.getItem('activeMenuItem');
            if (activeMenuItem) {
                const activeLink = document.querySelector(`.side-menu__item[href="${activeMenuItem}"]`);
                if (activeLink) {
                    // Loại bỏ lớp active khỏi tất cả các slide
                    document.querySelectorAll('.slide').forEach(function (slide) {
                        slide.classList.remove('active');
                    });

                    // Loại bỏ lớp active khỏi tất cả các side-menu__item
                    document.querySelectorAll('.side-menu__item').forEach(function (menuItem) {
                        menuItem.classList.remove('active');
                    });

                    // Thêm lớp active vào slide chứa mục được nhấp
                    const parentSlide = activeLink.closest('.slide');
                    if (parentSlide) {
                        parentSlide.classList.add('active');
                    }

                    // Thêm lớp active vào side-menu__item được nhấp
                    activeLink.classList.add('active');
                }
            }

            // Xử lý các nút trượt trái/phải
            const slideLeft = document.getElementById('slide-left');
            const slideRight = document.getElementById('slide-right');

            if (slideLeft) {
                slideLeft.addEventListener('click', function () {
                    const menu = document.querySelector('.main-menu');
                    if (menu) {
                        menu.scrollLeft -= 100;
                    }
                });
            }

            if (slideRight) {
                slideRight.addEventListener('click', function () {
                    const menu = document.querySelector('.main-menu');
                    if (menu) {
                        menu.scrollLeft += 100;
                    }
                });
            }

            // Improved sidebar toggle for mobile
            function toggleSidebar() {
                const sidebar = document.getElementById('sidebar');

                if (window.innerWidth <= 991.98) {
                    sidebar.classList.toggle('active');

                    // Add overlay for mobile
                    let overlay = document.querySelector('.sidebar-overlay');
                    if (!overlay) {
                        overlay = document.createElement('div');
                        overlay.className = 'sidebar-overlay';
                        overlay.style.cssText = `
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(0,0,0,0.5);
                            z-index: 998;
                            display: none;
                        `;
                        document.body.appendChild(overlay);

                        overlay.addEventListener('click', function () {
                            sidebar.classList.remove('active');
                            overlay.style.display = 'none';
                        });
                    }

                    overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none';
                }
            }

            // Attach toggle function to sidebar toggle buttons
            document.querySelectorAll('.sidemenu-toggle').forEach(function (toggle) {
                toggle.addEventListener('click', toggleSidebar);
            });

            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function (e) {
                const sidebar = document.getElementById('sidebar');
                const toggleBtn = e.target.closest('.sidemenu-toggle');

                if (window.innerWidth <= 991.98 &&
                    !e.target.closest('#sidebar') &&
                    !toggleBtn &&
                    sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    const overlay = document.querySelector('.sidebar-overlay');
                    if (overlay) overlay.style.display = 'none';
                }
            });

            // Handle window resize
            window.addEventListener('resize', function () {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.querySelector('.sidebar-overlay');

                if (window.innerWidth > 991.98) {
                    sidebar.classList.remove('active');
                    if (overlay) overlay.style.display = 'none';
                }
            });
        });



        document.addEventListener('DOMContentLoaded', function () {
            // Get the sidemenu toggle button
            const sideMenuToggle = document.querySelector('.sidemenu-toggle');

            // Get the html element that has the data-toggled attribute
            const htmlElement = document.documentElement;

            if (sideMenuToggle) {
                sideMenuToggle.addEventListener('click', function (e) {
                    e.preventDefault();

                    // Toggle the data-toggled attribute
                    if (htmlElement.hasAttribute('data-toggled')) {
                        htmlElement.removeAttribute('data-toggled');
                    } else {
                        htmlElement.setAttribute('data-toggled', 'icon-overlay-close');
                    }
                });
            }
        });
        document.addEventListener('DOMContentLoaded', function () {
            // Khởi tạo SimpleBar cho sidebar
            const sidebarElement = document.getElementById('sidebar-scroll');
            if (sidebarElement) {
                try {
                    new SimpleBar(sidebarElement);
                } catch (error) {
                    console.warn('Không thể khởi tạo SimpleBar cho sidebar:', error);
                }
            }

            // Khởi tạo SimpleBar cho các phần tử có thuộc tính data-simplebar
            const elements = document.querySelectorAll('[data-simplebar]');
            if (elements && elements.length > 0) {
                elements.forEach(function (element) {
                    try {
                        new SimpleBar(element);
                    } catch (error) {
                        console.warn('Không thể khởi tạo SimpleBar:', error);
                    }
                });
            }
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Tìm tất cả các menu có submenu
            const subMenus = document.querySelectorAll('.slide.has-sub > a.side-menu__item');

            subMenus.forEach(function (menu) {
                menu.addEventListener('click', function (e) {
                    e.preventDefault(); // Ngăn không cho điều hướng

                    const parentLi = menu.closest('.slide.has-sub');
                    const submenu = parentLi.querySelector('.slide-menu');

                    // Toggle class active & open
                    parentLi.classList.toggle('open');
                    parentLi.classList.toggle('active');
                    menu.classList.toggle('active');

                    // Toggle hiển thị menu con
                    if (submenu.style.display === 'block') {
                        submenu.style.display = 'none';
                    } else {
                        submenu.style.display = 'block';
                    }
                });
            });
        });
    </script>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.2/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>